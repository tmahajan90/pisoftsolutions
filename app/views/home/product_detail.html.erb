<!-- Product Detail Header -->
<section class="bg-gradient-to-br from-gray-50 to-blue-50 py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Breadcrumb -->
    <div class="mb-8">
      <nav class="flex" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
          <li class="inline-flex items-center">
            <a href="/" class="text-gray-700 hover:text-blue-600 text-sm font-medium">
              <i class="fas fa-home mr-2"></i>Home
            </a>
          </li>
          <li>
            <div class="flex items-center">
              <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
              <a href="/products" class="text-gray-700 hover:text-blue-600 text-sm font-medium">Products</a>
            </div>
          </li>
          <li>
            <div class="flex items-center">
              <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
              <span class="text-gray-500 text-sm font-medium"><%= @product.name %></span>
            </div>
          </li>
        </ol>
      </nav>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
      <!-- Product Info and Image (Left Side) -->
      <div class="space-y-6">
        <div>
          <h1 class="text-5xl font-bold text-gray-900 mb-4"><%= @product.name %></h1>
          <p class="text-xl text-gray-600 leading-relaxed"><%= @product.description %></p>
        </div>
        
        <!-- Rating -->
        <div class="flex items-center space-x-4">
          <div class="flex text-yellow-400 text-xl">
            <% @product.rating.to_i.times do %>
              <i class="fas fa-star"></i>
            <% end %>
            <% (5 - @product.rating.to_i).times do %>
              <i class="far fa-star"></i>
            <% end %>
          </div>
          <span class="text-gray-600 text-lg">(<%= @product.rating %>/5)</span>
          <span class="text-green-600 font-semibold">✓ Verified Reviews</span>
        </div>
        
        <!-- Product Image -->
        <div class="text-center lg:text-left">
          <div class="relative">
            <div class="w-80 h-80 bg-gradient-to-br from-<%= @product.color %>-500 to-<%= @product.color %>-600 rounded-3xl flex items-center justify-center mx-auto lg:mx-0 shadow-2xl">
              <i class="<%= product_icon(@product) %> text-9xl text-white"></i>
            </div>
            <!-- Badge -->
            <div class="absolute -top-4 -right-4">
              <span class="bg-<%= get_badge_color(@product.badge) %>-500 text-white text-sm font-bold px-4 py-2 rounded-full shadow-lg">
                <%= @product.badge %>
              </span>
            </div>
          </div>
          
          <!-- Product Stats -->
          <div class="mt-8 grid grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-gray-900"><%= @product.rating %></div>
              <div class="text-sm text-gray-600">Rating</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-gray-900"><%= @product.stock %></div>
              <div class="text-sm text-gray-600">In Stock</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-gray-900">24/7</div>
              <div class="text-sm text-gray-600">Support</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Plan Selection and Features (Right Side) -->
      <div class="space-y-6">
        <!-- Compact Plan Selection -->
        <div class="bg-white rounded-xl p-6 shadow-lg">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Choose Your Plan</h3>
                            <% 
                              # Get the appropriate price to display
                              display_price = if @product.get_validity_options.any?
                                # Use the default validity option price, or the first one if no default
                                default_option = @product.default_validity_option || @product.get_validity_options.first
                                default_option&.price
                              else
                                # Use the product's base price if no validity options exist
                                @product.price
                              end
                              
                              # Ensure we have a reasonable price (not 1.0 unless it's actually intended)
                              display_price = @product.price if display_price == 1.0 && @product.price != 1.0
                            %>
                            <div class="text-sm text-gray-500">Starting from ₹<%= display_price %></div>
          </div>
          
          <!-- Plan Dropdown -->
          <div class="relative mb-4">
            <select id="plan-select" class="validity-select w-full appearance-none bg-gray-50 border-2 border-gray-200 rounded-lg px-4 py-3 pr-10 text-lg font-semibold text-gray-900 focus:outline-none focus:ring-2 focus:ring-<%= @product.color %>-500 focus:border-<%= @product.color %>-500 transition-all duration-300">
              <% @product.get_validity_options.each_with_index do |option, index| %>
                <% 
                  is_trial = option.duration_type == 'days' && option.duration_value == 1
                  can_use_trial = current_user&.can_use_trial_for?(@product) || !current_user
                  trial_used = current_user&.has_used_trial_for?(@product)
                %>
                <option value="<%= index %>" 
                        data-validity="<%= option.duration_type %>" 
                        data-duration="<%= option.duration_value %>" 
                        data-price="<%= option.price %>"
                        data-label="<%= option.label %>"
                        data-trial="<%= is_trial %>"
                        data-can-use-trial="<%= can_use_trial %>"
                        data-trial-used="<%= trial_used %>"
                        <%= 'selected' if index == 0 %>>
                  <%= option.label %> - ₹<%= option.price %>
                  <% if is_trial %>
                    <% if can_use_trial %>
                      (Available)
                    <% else %>
                      (Already Used)
                    <% end %>
                  <% elsif option.lifetime? %>
                    (Best Value)
                  <% end %>
                </option>
              <% end %>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <i class="fas fa-chevron-down text-gray-400"></i>
            </div>
          </div>
          
          <!-- Selected Plan Summary -->
          <div id="selected-plan-details" class="bg-gray-50 rounded-lg p-4 border border-gray-200">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-10 h-10 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mr-3">
                  <i class="fas fa-clock text-lg text-<%= @product.color %>-600" id="plan-icon"></i>
                </div>
                <div>
                  <h4 class="text-lg font-bold text-gray-900" id="plan-name"><%= @product.get_validity_options.first&.label %></h4>
                  <p class="text-sm text-gray-600" id="plan-description">
                    <% if @product.get_validity_options.first&.lifetime? %>
                      Unlimited access forever
                    <% else %>
                      Full access for <%= @product.get_validity_options.first&.duration_value %> <%= @product.get_validity_options.first&.duration_type %>
                    <% end %>
                  </p>
                </div>
              </div>
              <div class="text-right">
                <div class="text-2xl font-bold text-<%= @product.color %>-600" id="plan-price">₹<%= @product.get_validity_options.first&.price %></div>
                <div class="text-xs text-gray-500">One-time payment</div>
              </div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="flex gap-3 mt-4">
            <button id="add-to-cart-btn" onclick="addToCartWithValidity(<%= @product.id %>)" class="flex-1 bg-<%= @product.color %>-600 hover:bg-<%= @product.color %>-700 text-white py-3 px-6 rounded-lg font-semibold text-lg transition duration-300 flex items-center justify-center">
              <i class="fas fa-shopping-cart mr-2"></i>
              Add to Cart
            </button>
            <button onclick="contactSales()" class="px-6 py-3 border-2 border-<%= @product.color %>-600 text-<%= @product.color %>-600 hover:bg-<%= @product.color %>-50 rounded-lg font-semibold text-lg transition duration-300">
              <i class="fas fa-headset mr-2"></i>
              Contact Sales
            </button>
          </div>
          
          <!-- Trial Status Message -->
          <% if @product.has_trial_option? %>
            <div id="trial-status" class="mt-3 p-3 rounded-lg text-sm hidden">
              <% if current_user&.has_used_trial_for?(@product) %>
                <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg p-3">
                  <i class="fas fa-info-circle mr-2"></i>
                  You have already used the trial for this product. Contact support if you need assistance.
                </div>
              <% elsif current_user&.can_use_trial_for?(@product) %>
                <div class="bg-green-50 border border-green-200 text-green-800 rounded-lg p-3">
                  <i class="fas fa-check-circle mr-2"></i>
                  Trial available! You can use the 1-day trial option.
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
        
        <!-- Key Features -->
        <div class="bg-white rounded-xl p-6 shadow-lg">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Key Features</h3>
          <% if @product.features_list.any? %>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <% @product.features_list.each do |feature| %>
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 mr-3"></i>
                  <span class="text-gray-700"><%= feature %></span>
                </div>
              <% end %>
            </div>
          <% else %>
            <!-- Default features if none are set -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span class="text-gray-700">Easy Setup & Integration</span>
              </div>
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span class="text-gray-700">24/7 Technical Support</span>
              </div>
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span class="text-gray-700">99.9% Uptime Guarantee</span>
              </div>
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span class="text-gray-700">Regular Updates</span>
              </div>
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span class="text-gray-700">Analytics & Reporting</span>
              </div>
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 mr-3"></i>
                <span class="text-gray-700">Mobile Responsive</span>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</section>



<!-- Product Features -->
<section class="py-16 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-gray-900 mb-4">Why Choose <%= @product.name %>?</h2>
      <p class="text-xl text-gray-600">Everything you need to succeed with our platform</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="bg-white rounded-xl p-8 shadow-lg text-center">
        <div class="w-16 h-16 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-rocket text-2xl text-<%= @product.color %>-600"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Easy Setup</h3>
        <p class="text-gray-600">Get started in minutes with our simple setup process and comprehensive documentation</p>
      </div>
      
      <div class="bg-white rounded-xl p-8 shadow-lg text-center">
        <div class="w-16 h-16 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-shield-alt text-2xl text-<%= @product.color %>-600"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Secure & Reliable</h3>
        <p class="text-gray-600">Enterprise-grade security with 99.9% uptime guarantee and regular backups</p>
      </div>
      
      <div class="bg-white rounded-xl p-8 shadow-lg text-center">
        <div class="w-16 h-16 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-headset text-2xl text-<%= @product.color %>-600"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-4">24/7 Support</h3>
        <p class="text-gray-600">Round-the-clock technical support and customer service via chat, email, and phone</p>
      </div>
      
      <div class="bg-white rounded-xl p-8 shadow-lg text-center">
        <div class="w-16 h-16 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-sync-alt text-2xl text-<%= @product.color %>-600"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Regular Updates</h3>
        <p class="text-gray-600">Continuous improvements and new features added regularly to keep you ahead</p>
      </div>
      
      <div class="bg-white rounded-xl p-8 shadow-lg text-center">
        <div class="w-16 h-16 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-chart-line text-2xl text-<%= @product.color %>-600"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Analytics & Reports</h3>
        <p class="text-gray-600">Comprehensive analytics and detailed reporting to track your performance</p>
      </div>
      
      <div class="bg-white rounded-xl p-8 shadow-lg text-center">
        <div class="w-16 h-16 bg-<%= @product.color %>-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i class="fas fa-mobile-alt text-2xl text-<%= @product.color %>-600"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Mobile Friendly</h3>
        <p class="text-gray-600">Access from anywhere with our mobile-optimized interface and responsive design</p>
      </div>
    </div>
  </div>
</section>

<!-- Related Products -->
<% if @related_products.any? %>
<section class="py-16 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-gray-900 mb-4">You Might Also Like</h2>
      <p class="text-xl text-gray-600">Explore our other products and solutions</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <% @related_products.each do |product| %>
        <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
          <div class="relative">
            <div class="h-32 bg-gradient-to-br from-<%= product.color %>-500 to-<%= product.color %>-600 flex items-center justify-center">
              <i class="<%= product_icon(product) %> text-4xl text-white"></i>
            </div>
            <div class="absolute top-2 left-2">
              <span class="bg-<%= get_badge_color(product.badge) %>-100 text-<%= get_badge_color(product.badge) %>-800 text-xs font-semibold px-2 py-1 rounded-full"><%= product.badge %></span>
            </div>
          </div>
          
          <div class="p-4">
            <h3 class="text-lg font-bold text-gray-900 mb-2"><%= product.name %></h3>
            <div class="flex items-center mb-2">
              <div class="flex text-yellow-400 text-sm">
                <% product.rating.to_i.times do %>
                  <i class="fas fa-star"></i>
                <% end %>
              </div>
              <span class="text-sm text-gray-600 ml-2">(<%= product.rating %>)</span>
            </div>
            <div class="flex items-center justify-between mb-3">
                                  <span class="text-xl font-bold text-<%= product.color %>-600">₹<%= product.get_validity_options.first&.price %></span>
              <span class="text-xs text-gray-500">Starting from</span>
            </div>
            <button onclick="window.location.href='<%= product_detail_path(product) %>'" class="w-full bg-<%= product.color %>-600 hover:bg-<%= product.color %>-700 text-white py-2 px-4 rounded-lg font-semibold text-sm transition duration-300">
              View Details
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</section>
<% end %>

<!-- CTA Section -->
<section class="py-20 bg-gradient-to-r from-<%= @product.color %>-600 to-<%= @product.color %>-700 text-white">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h2 class="text-5xl font-bold mb-6">Ready to Get Started?</h2>
    <p class="text-xl opacity-90 mb-8 leading-relaxed">
      Join thousands of businesses using <%= @product.name %> to grow their business and reach more customers.
    </p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <button onclick="addToCartWithValidity(<%= @product.id %>)" class="bg-white text-<%= @product.color %>-600 hover:bg-gray-100 px-8 py-4 rounded-lg font-semibold text-lg transition duration-300 flex items-center justify-center">
        <i class="fas fa-shopping-cart mr-3"></i>Get Started Now
      </button>
      <button onclick="contactSales()" class="border-2 border-white text-white hover:bg-white hover:text-<%= @product.color %>-600 px-8 py-4 rounded-lg font-semibold text-lg transition duration-300">
        <i class="fas fa-headset mr-2"></i>Contact Sales
      </button>
    </div>
    <p class="text-sm opacity-75 mt-4">✓ 30-day money-back guarantee • ✓ 24/7 support • ✓ Instant setup</p>
  </div>
</section>

<!-- Hidden data element for JavaScript -->
<div id="validity-options-data" style="display: none;"><%= raw @product.get_validity_options.map { |vo| { 
  label: vo.label, 
  type: vo.duration_type, 
  duration: vo.duration_value, 
  price: vo.price,
  trial: vo.trial?,
  can_use_trial: current_user&.can_use_trial_for?(@product) || !current_user,
  trial_used: current_user&.has_used_trial_for?(@product)
} }.to_json %></div>

<!-- Trial data for JavaScript -->
<div id="trial-data" style="display: none;" 
     data-product-id="<%= @product.id %>"
     data-has-trial="<%= @product.has_trial_option? %>"
     data-can-use-trial="<%= current_user&.can_use_trial_for?(@product) || !current_user %>"
     data-trial-used="<%= current_user&.has_used_trial_for?(@product) %>">
</div>
