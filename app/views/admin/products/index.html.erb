<% content_for :title, 'Products' %>
<% content_for :subtitle, 'Manage your product catalog' %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
          <i class="fas fa-box text-blue-600 text-xl"></i>
        </div>
        <div>
          <h3 class="text-2xl font-bold text-gray-900"><%= @total_products %></h3>
          <p class="text-gray-600">Total Products</p>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
          <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
        </div>
        <div>
          <h3 class="text-2xl font-bold text-gray-900"><%= @low_stock_products %></h3>
          <p class="text-gray-600">Low Stock Items</p>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-lg shadow p-6">
      <div class="flex items-center">
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
          <i class="fas fa-tags text-green-600 text-xl"></i>
        </div>
        <div>
          <h3 class="text-2xl font-bold text-gray-900"><%= @categories.count %></h3>
          <p class="text-gray-600">Categories</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="bg-white rounded-lg shadow mb-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-900">Search & Filters</h3>
        <div class="flex space-x-2">
          <%= link_to admin_products_path, class: "bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md font-medium" do %>
            <i class="fas fa-list mr-2"></i>View All
          <% end %>
          <%= link_to new_admin_product_path, class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium" do %>
            <i class="fas fa-plus mr-2"></i>Add Product
          <% end %>
        </div>
      </div>
    </div>
    <div class="p-6">
      <%= form_with url: admin_products_path, method: :get, local: true, class: "grid grid-cols-1 md:grid-cols-3 gap-4" do |form| %>
        <div>
          <%= form.label :search, "Search", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.text_field :search, value: params[:search], placeholder: "Product name, description, or category...", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        </div>
        <div>
          <%= form.label :category, "Category", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= form.select :category, options_for_select([['All Categories', '']] + @categories.map { |cat| [cat, cat] }, params[:category]), {}, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        </div>
        <div class="flex items-end">
          <%= form.submit "Search", class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium" %>
          <%= link_to "Clear", admin_products_path, class: "ml-2 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md font-medium" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bg-white rounded-lg shadow mb-6">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-semibold text-gray-900">Quick Actions</h3>
    </div>
    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="text-center p-4 bg-blue-50 rounded-lg">
          <i class="fas fa-plus-circle text-blue-600 text-2xl mb-2"></i>
          <h4 class="font-medium text-gray-900">Add Product</h4>
          <p class="text-sm text-gray-600">Create new product</p>
          <%= link_to new_admin_product_path, class: "mt-2 inline-block text-blue-600 hover:text-blue-800 text-sm font-medium" do %>
            Add Now →
          <% end %>
        </div>
        <div class="text-center p-4 bg-yellow-50 rounded-lg">
          <i class="fas fa-exclamation-triangle text-yellow-600 text-2xl mb-2"></i>
          <h4 class="font-medium text-gray-900">Low Stock</h4>
          <p class="text-sm text-gray-600"><%= @low_stock_products %> items</p>
          <%= link_to admin_products_path(category: ''), class: "mt-2 inline-block text-yellow-600 hover:text-yellow-800 text-sm font-medium" do %>
            View All →
          <% end %>
        </div>
        <div class="text-center p-4 bg-green-50 rounded-lg">
          <i class="fas fa-tags text-green-600 text-2xl mb-2"></i>
          <h4 class="font-medium text-gray-900">Categories</h4>
          <p class="text-sm text-gray-600"><%= @categories.count %> categories</p>
          <span class="mt-2 inline-block text-green-600 text-sm font-medium">
            Manage →
          </span>
        </div>
        <div class="text-center p-4 bg-purple-50 rounded-lg">
          <i class="fas fa-chart-line text-purple-600 text-2xl mb-2"></i>
          <h4 class="font-medium text-gray-900">Analytics</h4>
          <p class="text-sm text-gray-600">View reports</p>
          <%= link_to admin_dashboard_path, class: "mt-2 inline-block text-purple-600 hover:text-purple-800 text-sm font-medium" do %>
            Dashboard →
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-900">Products (<%= @products.count %> of <%= @total_products %>)</h3>
      </div>
    </div>
    
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rating</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Updated</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @products.each do |product| %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <% if product.image_url.present? %>
                    <% if product.image_url.start_with?('http') %>
                      <img class="h-10 w-10 rounded-lg object-cover" src="<%= product.image_url %>" alt="<%= product.name %>">
                    <% else %>
                      <div class="h-10 w-10 rounded-lg bg-gray-200 flex items-center justify-center">
                        <i class="<%= product.image_url %> text-gray-600"></i>
                      </div>
                    <% end %>
                  <% else %>
                    <div class="h-10 w-10 rounded-lg bg-gray-200 flex items-center justify-center">
                      <i class="fas fa-image text-gray-400"></i>
                    </div>
                  <% end %>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900"><%= product.name %></div>
                    <div class="text-sm text-gray-500"><%= truncate(product.description, length: 50) %></div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                    <%= product.category %>
                  </span>
                  <% if product.validity_type.present? %>
                    <div class="mt-1">
                      <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800">
                        <%= product.validity_display %>
                      </span>
                    </div>
                  <% end %>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-semibold text-gray-900">₹<%= number_with_precision(product.price, precision: 0) %></div>
                <% if product.original_price && product.original_price > product.price %>
                  <div class="text-xs text-gray-500 line-through">₹<%= number_with_precision(product.original_price, precision: 0) %></div>
                <% end %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                    <%= product.stock < 10 ? 'bg-red-100 text-red-800' : product.stock < 50 ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800' %>">
                    <%= product.stock %> in stock
                  </span>
                  <% if product.stock < 10 %>
                    <i class="fas fa-exclamation-triangle text-red-500 ml-2" title="Low stock alert"></i>
                  <% end %>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex items-center">
                    <% 5.times do |i| %>
                      <i class="fas fa-star <%= i < product.rating.to_i ? 'text-yellow-400' : 'text-gray-300' %> text-sm"></i>
                    <% end %>
                  </div>
                  <span class="ml-1 text-sm text-gray-500">(<%= product.rating %>)</span>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= product.updated_at.strftime("%b %d, %Y") %>
                <div class="text-xs text-gray-400"><%= product.updated_at.strftime("%I:%M %p") %></div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex space-x-2">
                  <%= link_to "View", admin_product_path(product), class: "text-blue-600 hover:text-blue-900" %>
                  <%= link_to "Edit", edit_admin_product_path(product), class: "text-indigo-600 hover:text-indigo-900" %>
                  <%= link_to "Delete", admin_product_path(product), 
                      method: :delete, 
                      data: { confirm: 'Are you sure you want to delete this product?' },
                      class: "text-red-600 hover:text-red-900" %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
