# 🌐 Domain Setup Guide for Pisoft Solutions

This guide will help you deploy your Pisoft Solutions application to a custom domain with SSL certificates, production-grade security, and optimal performance.

## 📋 Prerequisites

Before starting, ensure you have:

1. **Domain Name**: A registered domain (e.g., `pisoftsolutions.in`)
2. **DNS Access**: Ability to configure DNS records for your domain
3. **Server/VPS**: A server with Docker installed
4. **Email**: Valid email for SSL certificate notifications

## 🚀 Quick Deployment

### Single Command Deployment

```bash
# Make the script executable
chmod +x deploy-domain.sh

# Deploy to your domain
./deploy-domain.sh pisoftsolutions.in admin@pisoftsolutions.in
```

This single command will:
- ✅ Configure your domain
- 🔒 Generate SSL certificates
- 🐳 Set up Docker containers
- 🗄️ Configure database
- 🌱 Seed initial data
- 🚀 Deploy your application

## 📝 Step-by-Step Setup

### 1. DNS Configuration

Configure your domain's DNS records to point to your server:

```bash
# A Record
Type: A
Name: @
Value: YOUR_SERVER_IP

# A Record for www subdomain
Type: A
Name: www
Value: YOUR_SERVER_IP

# CNAME Record (alternative)
Type: CNAME
Name: www
Value: pisoftsolutions.in
```

### 2. Server Preparation

```bash
# Clone your repository
git clone https://github.com/your-username/pisoftsolutions.git
cd pisoftsolutions

# Make scripts executable
chmod +x deploy-domain.sh
chmod +x run.sh
chmod +x dev-setup.sh
```

### 3. Domain Deployment

```bash
# Deploy with your domain and email
./deploy-domain.sh pisoftsolutions.in admin@pisoftsolutions.in
```

### 4. Email Configuration

After deployment, update the SMTP settings in `.env.production`:

```bash
# Edit the environment file
nano .env.production

# Update these values:
SMTP_ADDRESS=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

## 🔧 Configuration Files Created

The deployment script creates several configuration files:

### 1. Environment Configuration (`.env.production`)
```bash
# Domain Configuration
DOMAIN=pisoftsolutions.in
RAILS_ENV=production

# Database Configuration
POSTGRES_DB=pisoftsolutions_production
POSTGRES_USER=pisoftsolutions
POSTGRES_PASSWORD=<auto-generated>

# Email Configuration
SMTP_ADDRESS=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

### 2. Nginx Configuration (`nginx/nginx.conf`)
- SSL/TLS configuration
- Security headers
- Rate limiting
- Gzip compression
- Static file caching

### 3. Docker Compose (`docker-compose.domain.yml`)
- Nginx reverse proxy
- SSL certificate management
- Rails application
- PostgreSQL database
- Redis cache

## 🔒 Security Features

### SSL/TLS Configuration
- **Automatic SSL**: Let's Encrypt certificates
- **HTTP/2**: Modern protocol support
- **HSTS**: Strict Transport Security
- **Security Headers**: XSS protection, content type options

### Rate Limiting
- **API**: 10 requests/second
- **Login**: 5 requests/minute
- **Burst**: Configurable burst limits

### Content Security Policy
- **Script Sources**: Self and inline
- **Style Sources**: Self and inline
- **Image Sources**: Self, data, and HTTPS
- **Font Sources**: Self and data

## 📊 Performance Optimizations

### Static File Caching
```nginx
location /assets/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### Gzip Compression
- **Enabled**: For all text-based files
- **Types**: CSS, JS, XML, JSON
- **Minimum Size**: 1024 bytes

### Database Optimization
- **Connection Pooling**: Optimized for production
- **Indexes**: Proper database indexing
- **Caching**: Redis for session storage

## 🔄 Maintenance Commands

### Application Management
```bash
# View logs
docker-compose -f docker-compose.domain.yml logs -f web

# Restart application
docker-compose -f docker-compose.domain.yml restart web

# Stop all services
docker-compose -f docker-compose.domain.yml down

# Update application
git pull
docker-compose -f docker-compose.domain.yml up -d --build
```

### SSL Certificate Management
```bash
# Renew SSL certificates
docker-compose -f docker-compose.domain.yml run --rm certbot renew

# Check certificate status
docker-compose -f docker-compose.domain.yml run --rm certbot certificates
```

### Database Management
```bash
# Access Rails console
docker-compose -f docker-compose.domain.yml exec web rails console

# Run migrations
docker-compose -f docker-compose.domain.yml exec web rails db:migrate

# Backup database
docker-compose -f docker-compose.domain.yml exec db pg_dump -U pisoftsolutions pisoftsolutions_production > backup.sql
```

## 🎯 Access Points

After successful deployment:

- **🌐 Main Site**: https://pisoftsolutions.in
- **🔧 Admin Panel**: https://pisoftsolutions.in/admin
- **📊 Health Check**: https://pisoftsolutions.in/health

### Default Credentials
- **Admin Email**: tarun@pisoftsolutions.in
- **Admin Password**: ox4ymoro
- **Demo Email**: demo@pisoftsolutions.in
- **Demo Password**: demo123

## 🚨 Troubleshooting

### SSL Certificate Issues
```bash
# Check certificate status
docker-compose -f docker-compose.domain.yml run --rm certbot certificates

# Force certificate renewal
docker-compose -f docker-compose.domain.yml run --rm certbot renew --force-renewal
```

### Application Not Starting
```bash
# Check container status
docker-compose -f docker-compose.domain.yml ps

# View detailed logs
docker-compose -f docker-compose.domain.yml logs web

# Check database connectivity
docker-compose -f docker-compose.domain.yml exec web rails db:version
```

### DNS Issues
```bash
# Test DNS resolution
nslookup pisoftsolutions.in
dig pisoftsolutions.in

# Check if ports are open
telnet pisoftsolutions.in 80
telnet pisoftsolutions.in 443
```

## 📈 Monitoring

### Health Checks
- **Application**: https://pisoftsolutions.in/health
- **Database**: Automatic connection monitoring
- **SSL**: Certificate expiration monitoring

### Log Monitoring
```bash
# Real-time logs
docker-compose -f docker-compose.domain.yml logs -f

# Application logs only
docker-compose -f docker-compose.domain.yml logs -f web

# Nginx logs
docker-compose -f docker-compose.domain.yml logs -f nginx
```

## 🔄 Updates and Maintenance

### Regular Maintenance Tasks
1. **SSL Renewal**: Certificates auto-renew every 60 days
2. **Security Updates**: Regular Docker image updates
3. **Database Backups**: Weekly automated backups
4. **Log Rotation**: Automatic log management

### Update Application
```bash
# Pull latest changes
git pull origin master

# Rebuild and restart
docker-compose -f docker-compose.domain.yml up -d --build

# Run migrations
docker-compose -f docker-compose.domain.yml exec web rails db:migrate
```

## 💡 Best Practices

1. **Backup Regularly**: Database and configuration files
2. **Monitor Logs**: Check for errors and performance issues
3. **Update Dependencies**: Keep Docker images and gems updated
4. **Security**: Regularly review security headers and SSL configuration
5. **Performance**: Monitor response times and optimize as needed

## 🆘 Support

If you encounter issues:

1. Check the troubleshooting section above
2. Review application logs for error messages
3. Verify DNS configuration
4. Ensure all prerequisites are met
5. Contact support with detailed error information

---

**🎉 Congratulations!** Your Pisoft Solutions application is now live on your custom domain with enterprise-grade security and performance optimizations.
